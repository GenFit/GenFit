# Create a library called "libgfrave" which includes the source files given in
# the array .
# The extension is already found.  Any number of sources could be listed here.

cmake_minimum_required(VERSION 2.6)

IF(NOT DEFINED ENV{RAVEPATH})
   MESSAGE(FATAL_ERROR "You did not define the environment variable RAVEPATH which is nedded to find rave. Please set this variable and execute cmake again.") 
ENDIF(NOT DEFINED ENV{RAVEPATH})

#check for ENV variables that are needed
IF(NOT DEFINED ENV{ROOTSYS})
   MESSAGE(FATAL_ERROR "You did not set the environment variable ROOTSYS. Please check your ROOT configuration.") 
ENDIF(NOT DEFINED ENV{ROOTSYS})
#IF(NOT DEFINED ENV{GENFIT})
#   MESSAGE(FATAL_ERROR "You did not set the environment variable GENFIT.") 
#ENDIF(NOT DEFINED ENV{GENFIT})

SET(RAVEPATH $ENV{RAVEPATH})

# get compiler flags from rave
SET(ENV{PKG_CONFIG_PATH} ${RAVEPATH})
INCLUDE(FindPkgConfig)
pkg_check_modules(RAVE REQUIRED rave)
foreach(flag ${RAVE_CFLAGS})
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${flag}") 
endforeach(flag)
MESSAGE("CMAKE_CXX_FLAGS: " ${CMAKE_CXX_FLAGS})


INCLUDE_DIRECTORIES(
$ENV{ROOTSYS}/include  
$ENV{GENFIT}/core 
$ENV{GENFIT}/GFRave
${CLHEP_INCLUDE_DIR}
${RAVEPATH}/include 
${RAVEPATH}/src
${RAVEPATH}/src/ROOT/mathcore
${RAVEPATH}/src/ROOT/smatrix
${RAVEPATH}/src/ROOT/genvector
${RAVEPATH}/src/ROOT
${RAVEPATH}/src/RaveBase/RaveInterface
)

set(GFRAVE_SRCS 
GFRaveVertexFactory.cxx
GFRaveTrackParameters.cxx
GFRaveVertex.cxx
GFRaveConverters.cxx  
GFRavePropagator.cxx  
GFRaveMagneticField.cxx  
)

set(GFRAVE_HEADERS 
GFRaveVertexFactory.h
GFRaveTrackParameters.h
GFRaveVertex.h
GFRaveConverters.h  
GFRavePropagator.h  
GFRaveMagneticField.h  
)



set(GFRAVE_LINKDEF  GFRaveLinkDef.h)
set(GFRAVE_DICTIONARY GFRaveDict.cxx) 

FIND_PROGRAM(ROOT_CINT_EXECUTABLE
	NAMES rootcint
	PATHS $ENV{ROOTSYS}/bin
	NO_DEFAULT_PATH)

ADD_CUSTOM_COMMAND(OUTPUT ${CMAKE_BINARY_DIR}/${GFRAVE_DICTIONARY}
	COMMAND ${ROOT_CINT_EXECUTABLE}
      	ARGS -f ${CMAKE_BINARY_DIR}/${GFRAVE_DICTIONARY} -c -DHAVE_CONFIG_H
      	-I${GENFIT}/core ${GFRAVE_HEADERS} ${GFRAVE_LINKDEF}
      	DEPENDS ${GFRAVE_HEADERS} ${GFRAVE_LINKDEF})

# SET(GFRAVE_SRCS_ALL ${GFRAVE_SRCS} ${CMAKE_BINARY_DIR}/${GFRAVE_DICTIONARY})
SET(GFRAVE_SRCS_ALL ${GFRAVE_SRCS})


################ install ###################

#add ROOT lib
Execute_process(COMMAND root-config --glibs --cflags
	OUTPUT_VARIABLE ROOT_LIBS
    	OUTPUT_STRIP_TRAILING_WHITESPACE)

add_library(gfrave SHARED ${GFRAVE_SRCS_ALL})
target_link_libraries(gfrave ${ROOT_LIBS})

install(TARGETS gfrave DESTINATION $ENV{GENFIT}/lib)

